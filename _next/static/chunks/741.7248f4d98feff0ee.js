"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[741],{741:function(e,t,a){a.d(t,{Z:function(){return L}});var r=a(7437),n=a(2265),i=a(8964),o=a(9465),c=a(636),s=a(2735),l=a(292),d=a(5836),f=a(5136),u=a(5868),m=a(8930),h=a(9658),p=a(1103),y=a(7814),x=a(277),w=a(4508),g=a(2869);let F=x.fC,j=x.xz,S=x.h_,v=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(x.aV,{className:(0,w.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n,ref:t})});v.displayName=x.aV.displayName;let C=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsxs)(S,{children:[(0,r.jsx)(v,{}),(0,r.jsx)(x.VY,{ref:t,className:(0,w.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n})]})});C.displayName=x.VY.displayName;let E=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,w.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};E.displayName="AlertDialogFooter";let b=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(x.Dx,{ref:t,className:(0,w.cn)("text-lg font-semibold",a),...n})});b.displayName=x.Dx.displayName;let D=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(x.dk,{ref:t,className:(0,w.cn)("text-sm text-muted-foreground",a),...n})});D.displayName=x.dk.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(x.aU,{ref:t,className:(0,w.cn)((0,g.d)(),a),...n})}).displayName=x.aU.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(x.$j,{ref:t,className:(0,w.cn)((0,g.d)({variant:"outline"}),"mt-2 sm:mt-0",a),...n})}).displayName=x.$j.displayName;var k=a(9987);let P=(0,a(7712).j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),N=n.forwardRef((e,t)=>{let{className:a,variant:n,size:i,...o}=e;return(0,r.jsx)(k.f,{ref:t,className:(0,w.cn)(P({variant:n,size:i,className:a})),...o})});N.displayName=k.f.displayName;var A=a(6512),z=a(8753);let R=n.forwardRef((e,t)=>{let{className:a,value:n,...i}=e;return(0,r.jsx)(z.fC,{ref:t,className:(0,w.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...i,children:(0,r.jsx)(z.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});R.displayName=z.fC.displayName;var I=a(4438),Z=a(7635),U=a.n(Z);class _{static async Init(e){return new Promise(async(t,a)=>{_.activeMount&&await _.Unmount(_.activeMount),FS.analyzePath("/".concat(e)).exists||FS.mkdir(e),FS.mount(IDBFS,{root:"/".concat(e)},e),await _.SyncInit(),_.activeMount=e,_.fspath="/".concat(e),t()})}static async Unmount(e){return new Promise(t=>{FS.unmount(e),_.activeMount===e&&(_.activeMount=null),t()})}static async SyncInit(){return new Promise((e,t)=>{FS.syncfs(!0,function(a){a?(_.AlertError("EngineFS.SyncInit Error: ".concat(a)),t(a)):e()})})}static async Save(){return new Promise((e,t)=>{FS.syncfs(function(a){a?(_.AlertError("EngineFS.Save Error: ".concat(a)),t(a)):(console.log("Synchronized FS"),e())})})}static AlertError(e){alert(e),console.error(e)}static async FileUpload(e){return _.FileUploadDlg(e,e=>_.FileUploadCommon(e,!0))}static async DropFileUpload(e){return _.FileUploadCommon(e,!0)}static async FileUploadDlg(e,t){return new Promise((a,r)=>{let n=document.createElement("input");n.type="file",n.multiple=!0,e&&(n.webkitdirectory=!0),n.onchange=async()=>{if(!n.files||!n.files.length){console.warn("EngineFS.FileUpload: No files selected for upload"),r();return}try{await t(n.files),a()}catch(e){r(e)}},n.click()})}static async FileUploadCommon(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_.fspath;_.actionInProgress=!0,_.actionProgress=0;try{for(let t=0;t<e.length;t++){let r=e[t],n="".concat(a,"/").concat(r.webkitRelativePath||r.name);_.actionStatus="Uploading ".concat(n,"...");let i="";for(let e of PATH.dirname(n).split("/"))i+="/".concat(e),FS.analyzePath(i).exists||FS.mkdir(i);r.name.toLowerCase().endsWith(".zip")?await _.DoZipExtract(r):await _.DoFileWrite(r,n)}t&&await _.Save()}finally{_.actionInProgress=!1,_.actionProgress=0,_.actionStatus=""}}static async DoZipExtract(e){try{await _.ZipExtract(e,_.fspath)}catch(e){throw _.AlertError("EngineFS.DoZipExtract Zip Error: ".concat(e)),e}}static async DoFileWrite(e,t){return new Promise((a,r)=>{let n=new FileReader;n.onprogress=e=>{e.lengthComputable&&(_.actionProgress=e.loaded/e.total*100)},n.onload=async()=>{try{FS.writeFile(t,new Uint8Array(await e.arrayBuffer()),{encoding:"binary"}),a()}catch(e){_.AlertError("EngineFS.DoFileWrite Error: ".concat(e)),r(e)}},n.readAsArrayBuffer(e)})}static async FileDownload(e){try{let t=new(U()),a=async(e,r)=>{if(!FS.lookupPath(e).node){console.warn("Tried to add ".concat(e," to zip for export. Doesn't exist!"));return}if(await _.DirectoryCheck(e))for(let t of FS.readdir(e)){if("."===t||".."===t)continue;let n="".concat(e,"/").concat(t),i="".concat(r,"/").concat(t);await a(n,i)}else{let a=FS.readFile(e);t.file(r,a)}};for(let t of e)await a(t,t.split("/").pop());(0,I.Am)("Attempting to download files...");let r=await t.generateAsync({type:"blob"}),n=document.createElement("a");n.href=URL.createObjectURL(r),n.download="export.zip",document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),URL.revokeObjectURL(n.href)},100)}catch(e){throw _.AlertError("EngineFS.FileDownload Error: ".concat(e)),e}}static async DirectoryCheck(e){let t=FS.lookupPath(e).node.mode;return FS.isDir(t)}static async DirectoryCreate(e){try{let t="".concat(_.fspath,"/").concat(e);FS.mkdir(t),await _.Save(),console.log("EngineFS.DirectoryCreate: Created ".concat(t)),(0,I.Am)("Created directory ".concat(t,"."))}catch(e){throw _.AlertError("EngineFS.DirectoryCreate Error: ".concat(e)),e}}static async Cut(e){_.clipboard={items:e,isCut:!0}}static async Copy(e){_.clipboard={items:e,isCut:!1}}static async Paste(){if(!_.clipboard){console.warn("Clipboard is empty. No items to paste.");return}let{items:e,isCut:t}=_.clipboard,a=e.map(async e=>{let a=e.path,r="".concat(_.fspath,"/").concat(e.name);console.log("Attempting to paste ".concat(t?"move":"copy",": ").concat(a," -> ").concat(r)),_.actionInProgress=!0;try{if(!FS.lookupPath(a).node){_.AlertError("EngineFS.Paste: Source path does not exist."),_.actionInProgress=!1;return}t?FS.rename(a,r):await _.ItemDoCopy(e,a,r),(0,I.Am)("Pasted item ".concat(a," to ").concat(r,"."))}catch(e){_.AlertError("EngineFS.Paste Error: ".concat(e)),_.actionInProgress=!1}});await Promise.all(a),await _.Save(),_.actionInProgress=!1,_.clipboard=null}static async Rename(e,t){try{let a="".concat(_.fspath,"/").concat(e),r="".concat(_.fspath,"/").concat(t);if(!FS.lookupPath(a).node)throw Error('Item "'.concat(e,'" does not exist.'));FS.rename(a,r),await _.Save(),(0,I.Am)("".concat(a," Renamed to ").concat(r,"."))}catch(e){throw _.AlertError("EngineFS.Rename Error: ".concat(e)),e}}static async Delete(e){try{if(!window.confirm("Are you sure you want to delete the selected items? This action is irreversible."))return;let t="Uninitialized";for(let a of e){if(t="".concat(_.fspath,"/").concat(a),!FS.lookupPath(t).node){console.warn('Tried to delete "'.concat(a,"\" - which doesn't exist?"));continue}await _.DirectoryCheck(t)?_.DirectoryDeleteRecursive(t):FS.unlink(t)}await _.Save(),console.log("EngineFS.Delete: ".concat(t," deleted")),(0,I.Am)("".concat(t," Deleted."))}catch(e){throw _.AlertError("EngineFS.Delete Error: ".concat(e)),e}}static async GetPathItems(){let e=[];for(let t of FS.readdir(_.fspath)){if("."===t||".."===t)continue;let a="".concat(_.fspath,"/").concat(t);e.push({name:t,path:a,isDirectory:await _.DirectoryCheck(a)})}return e}static PathNormalize(e){return e.replace(/\/+/g,"/").replace(/\/$/,"")}static CheckSubdir(e,t){let a=e.split("/"),r=t.split("/");return r.length>a.length&&a.every((e,t)=>e===r[t])}static async ItemDoCopy(e,t,a){return new Promise(async(r,n)=>{if(_.CheckSubdir(_.PathNormalize(t),_.PathNormalize(a))){alert("Whoa there!\nThe destination folder is a subfolder of the source folder"),n();return}let i=a,o=1;for(;FS.analyzePath(i).exists;)i="".concat(a.replace(/(.*\/)?([^\/]*)$/,"$1".concat(e.name," - Copy").concat(o>1?" (".concat(o,")"):""))),o++;if(e.isDirectory){try{FS.stat(i)}catch(e){FS.mkdir(i)}await _.DirectoryCopyRecursive(t,i),r();return}FS.writeFile(i,FS.readFile(t)),r()})}static async ZipExtract(e,t){return new Promise(async(a,r)=>{try{let r=await U().loadAsync(e);console.log("Loaded ZIP file");let n=[],i=[];r.forEach((e,a)=>{let r="".concat(t,"/").concat(e);a.dir?n.push(r):i.push({path:r,entry:a})}),n.forEach(e=>{let t=e.split("/"),a=t.shift()||"";t.forEach(e=>{a+="/".concat(e),FS.analyzePath(a).exists||FS.mkdir(a)})}),await Promise.all(i.map(async e=>{let{path:t,entry:a}=e,r=await a.async("uint8array"),n=PATH.dirname(t);FS.analyzePath(n).exists||FS.mkdir(n),FS.writeFile(t,r,{encoding:"binary"})})),console.log("Zip extraction complete! Synchronizing FileSystem..."),await _.Save(),_.actionInProgress=!1,(0,I.Am)("Extracted ZIP ".concat(e.name," to ").concat(t,".")),a()}catch(e){_.AlertError("EngineFS.ZipExtract Error: ".concat(e)),r(e)}})}static async DirectoryCopyRecursive(e,t){return new Promise(async(a,r)=>{try{try{FS.stat(t)}catch(e){FS.mkdir(t)}let r=FS.readdir(e);await Promise.all(r.map(async r=>{if("."===r||".."===r)return;let n="".concat(e,"/").concat(r),i="".concat(t,"/").concat(r);if(await _.DirectoryCheck(n))await _.DirectoryCopyRecursive(n,i),a();else try{FS.stat(i),console.warn("File ".concat(i," already exists. Skipping.")),a()}catch(e){FS.writeFile(i,FS.readFile(n)),a()}}))}catch(a){_.AlertError("EngineFS.DirectoryCopyRecursive Error: ".concat(a," - from ").concat(e," -> ").concat(t)),r()}})}static DirectoryDeleteRecursive(e){return new Promise(async(t,a)=>{try{FS.readdir(e).forEach(a=>{if("."===a||".."===a)return;let r=e+"/"+a,n=FS.stat(r);FS.isDir(n.mode)?(_.DirectoryDeleteRecursive(r),t()):FS.isFile(n.mode)&&(FS.unlink(r),t())}),FS.rmdir(e),t()}catch(t){_.AlertError("EngineFS.DirectoryDeleteRecursive Error: ".concat(t," - target -> ").concat(e)),a()}})}}_.fspath="//FileSystem",_.activeMount=null,_.actionInProgress=!1,_.actionProgress=0,_.actionStatus="",_.clipboard=null;var M=a(866),T=a(8194),L=e=>{let{id:t}=e,{AddNode:a,ResetNodes:x}=(0,T.f)(),w=(0,M.d)(),[S,v]=n.useState([]),[k,P]=n.useState([]),z=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.join("/").replace(/\/+/g,"/")},Z=async()=>{v(await _.GetPathItems()),B(_.fspath)};n.useEffect(()=>{(async()=>{try{await _.Init(t),await Z()}catch(e){console.error("Error loading files:",e)}})()},[t]);let[U,L]=n.useState(!1),[J,$]=n.useState(0);n.useEffect(()=>{let e=setInterval(()=>{L(_.actionInProgress),$(_.actionProgress)},100);return()=>clearInterval(e)},[]);let B=e=>{let t=e.split("/").filter(Boolean);x(),t.forEach((e,r)=>{let n=z("/",...t.slice(0,r+1));a(e,n,()=>V(n))})},V=async e=>{_.fspath=e,await Z()},W=async()=>{let e=prompt("Folder name:");e&&(_.DirectoryCreate(e),await Z())},G=async()=>{if(0===k.length)return;let e=k.map(e=>z(_.fspath,e));await _.FileDownload(e)},O=async()=>{let e=S.filter(e=>k.includes(e.name));await _.Cut(e)},Y=async()=>{let e=S.filter(e=>k.includes(e.name));await _.Copy(e)},H=async()=>{await _.Paste(),await Z()},K=async()=>{if(1!==k.length){alert("You can only rename one item at a time.");return}let e=k[0],t=prompt("New item name:",e);if(t&&t!==e)try{await _.Rename(e,t),await Z()}catch(e){console.error("Error renaming item:",e)}},X=async()=>{await _.Delete(k),await Z(),P([])},[Q,q]=n.useState(null),ee=(e,t,a)=>{t.stopPropagation(),P(r=>{if(t.ctrlKey)return r.includes(e)?r.filter(t=>t!==e):[...r,e];if(!t.shiftKey||null===Q)return q(a),[e];{let e=Math.max(Q,a);return Array.from(new Set([...r,...S.slice(Math.min(Q,a),e+1).map(e=>e.name)]))}})},et=async e=>{e.isDirectory&&V(z(_.fspath,e.name))},[ea,er]=n.useState(!1),en=async e=>{e.preventDefault(),e.stopPropagation(),er(!1);let t=Array.from(e.dataTransfer.items),a=!1;for(let e of t)if("file"===e.kind&&e.webkitGetAsEntry){let t=e.webkitGetAsEntry();if(t.isFile){let t=e.getAsFile();t&&(await _.FileUploadCommon([t],!1,_.fspath),a=!0)}else if(t.isDirectory){let e=z(_.fspath,t.name);await FS.mkdir(e),await ei(t,e),a=!0}}a&&await _.Save(),await Z()},ei=async(e,t)=>{let a=e.createReader(),r=[],n=()=>new Promise(e=>{a.readEntries(t=>{t.length?(r.push(...t),n().then(e)):e(r)})}),i=async e=>new Promise((t,a)=>{e.file(t,a)});for(let e of(await n()))if(e.isFile){let a=await i(e);await _.FileUploadCommon([a],!1,t)}else if(e.isDirectory){let a=z(t,e.name);await FS.mkdir(a),await ei(e,a)}},eo=[{icon:(0,r.jsx)(i.Z,{}),label:"Add New File",onClick:async()=>{await _.FileUpload(!1),await Z()}},{icon:(0,r.jsx)(o.Z,{}),label:"Add New Folder",onClick:async()=>{await _.FileUpload(!0),await Z()}},{icon:(0,r.jsx)(c.Z,{}),label:"Create New Folder",onClick:W},{icon:(0,r.jsx)(s.Z,{}),label:"Download Item",onClick:G}];return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)(F,{open:U,children:[(0,r.jsx)(j,{}),(0,r.jsxs)(C,{children:[(0,r.jsx)(b,{children:(0,r.jsxs)("div",{className:"flex items-center justify-start space-x-2",children:[(0,r.jsx)(c.Z,{}),(0,r.jsx)("span",{children:"Uploading Files"})]})}),(0,r.jsxs)(D,{children:[_.actionStatus," ",J.toFixed(2),"%"]}),(0,r.jsx)(E,{children:(0,r.jsx)(R,{className:"h-2",value:J})})]})]}),(0,r.jsx)("div",{className:"flex flex-wrap items-center gap-2 ".concat(w?"fixed bottom-0 left-0 w-full border-t bg-background/95 p-2 backdrop-blur supports-[backdrop-filter]:bg-background/60":""),children:(0,r.jsxs)(p.pn,{children:[w?(0,r.jsxs)(y.dy,{shouldScaleBackground:!0,children:[(0,r.jsx)(y.Qz,{asChild:!0,children:(0,r.jsx)(g.z,{variant:"outline",className:"flex-grow h-16",children:(0,r.jsx)(c.Z,{})})}),(0,r.jsxs)(y.sc,{children:[(0,r.jsxs)(y.OX,{children:[(0,r.jsx)(y.iI,{children:"File Actions"}),(0,r.jsx)(y.u6,{children:"Additional file creation options."})]}),(0,r.jsxs)(y.ze,{className:"flex flex-col w-full h-full",children:[eo.map((e,t)=>(0,r.jsxs)(g.z,{variant:"outline",onClick:e.onClick,className:"gap-2 justify-start w-full flex-grow",children:[e.icon,(0,r.jsx)("span",{children:e.label})]},t)),(0,r.jsx)(y.uh,{asChild:!0,children:(0,r.jsx)(g.z,{className:"w-full justify-center mt-2 flex-grow",children:"Close"})})]})]})]}):(0,r.jsx)(r.Fragment,{children:eo.map((e,t)=>(0,r.jsxs)(p.u,{children:[(0,r.jsx)(p.aJ,{asChild:!0,children:(0,r.jsx)(g.z,{variant:"outline",onClick:e.onClick,children:e.icon})}),(0,r.jsx)(p._v,{children:(0,r.jsx)("p",{children:e.label})})]},t))}),(0,r.jsx)(A.Z,{orientation:"vertical",className:"h-4"}),(0,r.jsxs)(p.u,{children:[(0,r.jsx)(p.aJ,{asChild:!0,children:(0,r.jsx)(g.z,{variant:"outline",onClick:O,className:"".concat(w?"flex-grow h-16":""),children:(0,r.jsx)(l.Z,{})})}),(0,r.jsx)(p._v,{children:(0,r.jsx)("p",{children:"Cut selected item"})})]}),(0,r.jsxs)(p.u,{children:[(0,r.jsx)(p.aJ,{asChild:!0,children:(0,r.jsx)(g.z,{variant:"outline",onClick:Y,className:"".concat(w?"flex-grow h-16":""),children:(0,r.jsx)(d.Z,{})})}),(0,r.jsx)(p._v,{children:(0,r.jsx)("p",{children:"Copy selected item"})})]}),(0,r.jsxs)(p.u,{children:[(0,r.jsx)(p.aJ,{asChild:!0,children:(0,r.jsx)(g.z,{variant:"outline",onClick:H,className:"".concat(w?"flex-grow h-16":""),children:(0,r.jsx)(f.Z,{})})}),(0,r.jsx)(p._v,{children:(0,r.jsx)("p",{children:"Paste item"})})]}),(0,r.jsxs)(p.u,{children:[(0,r.jsx)(p.aJ,{asChild:!0,children:(0,r.jsx)(g.z,{variant:"outline",onClick:K,className:"".concat(w?"flex-grow h-16":""),children:(0,r.jsx)(u.Z,{})})}),(0,r.jsx)(p._v,{children:(0,r.jsx)("p",{children:"Rename item"})})]}),(0,r.jsxs)(p.u,{children:[(0,r.jsx)(p.aJ,{asChild:!0,children:(0,r.jsx)(g.z,{variant:"outline",onClick:X,className:"".concat(w?"flex-grow h-16":""),children:(0,r.jsx)(m.Z,{})})}),(0,r.jsx)(p._v,{children:(0,r.jsx)("p",{children:"Delete selected item"})})]})]})}),(0,r.jsx)("div",{className:"flex-1 ".concat(w?"mt-0 pb-20 gap-2":"mt-4"," overflow-y-auto flex flex-col"),onClick:()=>P([]),onDragOver:e=>{e.preventDefault(),e.stopPropagation(),er(!0)},onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),er(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),er(!1)},onDrop:en,children:S.map((e,t)=>(0,r.jsx)(N,{className:"".concat(w?"":"h-8"," px-3 w-full items-center justify-start file-item flex-shrink-0"),"aria-pressed":k.includes(e.name),"data-state":k.includes(e.name)?"on":"off",onClick:a=>ee(e.name,a,t),onDoubleClick:()=>et(e),children:(0,r.jsxs)("a",{className:"flex items-center gap-2 w-full",children:[e.isDirectory?(0,r.jsx)(c.Z,{width:"16px",height:"16px"}):(0,r.jsx)(h.Z,{width:"16px",height:"16px"}),(0,r.jsx)("span",{children:e.name})]})},t))}),(0,r.jsx)(I.x7,{})]})}}}]);